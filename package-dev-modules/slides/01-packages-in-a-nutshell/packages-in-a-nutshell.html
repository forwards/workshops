<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Packages in a nutshell</title>
    <meta charset="utf-8" />
    <meta name="author" content=" Emma Rand" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <link rel="stylesheet" href="style-xaringanthemer.css" type="text/css" />
    <link rel="stylesheet" href="style-custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Packages in a nutshell
## A Forwards Package Development module
### <br>Emma Rand
### <br>üîó <a href="http://bit.ly/pkg-dev-1">bit.ly/pkg-dev-1</a>

---




layout: true
  
&lt;div class="my-footer"&gt;
&lt;span&gt;
&lt;a href="http://bit.ly/pkg-dev-1" target="_blank"&gt;üîó bit.ly/pkg-dev-1&lt;/a&gt;
&lt;/span&gt;
&lt;/div&gt; 

&lt;!-- Presenting on zoom or similar? Press C to clone you slides, then P for presenter mode for one set. You can share the whole screen version of the slides while still seeing you presenter view --&gt;
---

## Welcome!

.pull-left[
.center[
&lt;img src="images/emma-rand.png" width="45%" style="display: block; margin: auto;" /&gt;
Emma Rand  
.small[
Senior Lecturer (Prof)  
Department of Biology, University of York, UK 
]
]
]
.pull-right[
.center[
&lt;img src="images/mine.jpg" width="45%" style="display: block; margin: auto;" /&gt;
Dr. Mine √áetinkaya-Rundel 
.small[
Senior lecturer (Prof)  
School of Maths, University of Edinburgh, UK   
RStudio
]
]
]

.center[
[Forwards](https://forwards.github.io/) Teaching Team Leads
]

???


Hello and welcome to Packages in a Nutshell!
We are Emma Rand and Mine √áetinkaya-Rundel and we are part of R Forwards which is an R Foundation task force to address underrepresentation in the R community and particularly the developer community.

Forwards have delivered face-to-face one-day workshops in Package development, supported by a grant from the R Consortium, for several years. These are heavily based on the R packages book by Hadley Wickham and Jenny Bryan. Recently we have been modularising our workshop materials with the aim of increasing our ability to reach the many people who can't travel to a one-day workshop and make it easier for others to teach with our materials.



---

## Summary

This workshop explains what a package is and why you might want to write one. 

-  where packages come from
-  where they live on your computer
-  package states
-  package components


???

This workshop explains what a package is and why you might want to write one.
It covers where packages come from, where they live on your computer and the different states a package can be in. 
We will explore the key components of a package using an example and outline the Forwards approach to package development process.

---

## Module Prerequisites

Before starting this module you should have:

-  [installed R and RStudio](../prerequisite-guides/install-r-rstudio.md)

-  had some experience of coding in R 

-  and it will help to have previously installed and loaded packages

I suggest opening RStudio if you want to code along

???
 The coding will be fairly short commands  - you will not need a lot of space and can split your screen with zoom and RStudio.


---

## Be excellent to each other!

üíõ Please use the chat!

üíú Be kind

üíö Be respectful

???

Our intention is make time for asking questions. Please use the chat.
We hope you will feel comfortable posting your questions 'To everyone'
because that will help create a supportive learning space for all of us but if you feel more comfortable messaging me or Mine, that's fine.


---

## Learning Objectives

At the end of this module the successful learner will be able to:

- explain the rationale for writing packages

- find and explore their own package library/libraries

- describe the key components of a package

- describe the different states a package can be in

- outline the development of a package using devtools


???

Add speaker notes

---

class: middle, inverse

# Why write a package?

---

## Why reusable components

-  You want to **generalise** it

-  You want to **document** it

-  You want to **test** it

-  You want to **share** it

-  You want to create **impact** from your work


???

Making a package helps you make your work more reusable. If you find your self copying and pasting chunks of code and changing a few variable names it means you are doing some thing that could be generalised. You may have written functions to save yourself some copying and pasting.

Making a package takes that a step further. You do not need to make a package for others to use - it can be just for your use.

The conventions and infrastructure around a package encourage you to document and test your functions.

These aspects allow you to work reproducibly, collaborate with others and disseminate your work more easily.

This helps you gain recognition and create impact from your work.

---

## The bad news

.... it may be frustrating
&lt;img src="images/allie_brosh_argh.png" title="cartoon of a distressed being wrapped in a blanket" alt="cartoon of a distressed being wrapped in a blanket" width="500px" style="display: block; margin: auto;" /&gt;

.tiny[
COPYRIGHT: Allie Brosh  http://hyperboleandahalf.blogspot.com/2010/09/four-levels-of-social-entrapment.html
]


???

It may be frustrating because working in a new way and learning new things is frustrating.

---

## The good news!

.... frustration is normal and temporary.
&lt;img src="images/allie_brosh_happy.png" title="cartoon of a happy being sat at a desk and typing on laptop at 03:17" alt="cartoon of a happy being sat at a desk and typing on laptop at 03:17" width="500px" style="display: block; margin: auto;" /&gt;

.tiny[
COPYRIGHT: Allie Brosh  http://hyperboleandahalf.blogspot.com/2010/06/this-is-why-ill-never-be-adult.html
]


???

Add speaker notes

---

class: middle, inverse

# Where do packages live?


???

Let us start by thinking about where packages live on your computer

---

## R packages live in a library

&lt;img src="images/library.png" title="photo of a library with a  central atrium from ground to top floor flanked by six floors of shelved books" alt="photo of a library with a  central atrium from ground to top floor flanked by six floors of shelved books" width="500px" style="display: block; margin: auto;" /&gt;

--

Where's the library?


???
This is the sort of statement experts make! What *is* a library?
A directory into which packages are installed.
We can start to answer this by learning more about our R installation.

---

## Get to know your R installation.

.your-turn[
What version of R are you using?
]

.scroll-output-height[

```r
R.version
```

```
##                _                           
## platform       x86_64-apple-darwin17.0     
## arch           x86_64                      
## os             darwin17.0                  
## system         x86_64, darwin17.0          
## status                                     
## major          4                           
## minor          0.3                         
## year           2020                        
## month          10                          
## day            10                          
## svn rev        79318                       
## language       R                           
## version.string R version 4.0.3 (2020-10-10)
## nickname       Bunny-Wunnies Freak Out
```
]

???

These green boxes are to indicate it is your turn to do something.

It's your turn. Type R.version to see what version of R you are using.

Post your version in chat.

---

## Get to know your R installation.

.your-turn[
Where is R's home directory?
]


```r
R.home()
```

```
## [1] "/Library/Frameworks/R.framework/Resources"
```

The R home directory is the top-level directory of the R installation being run.

Note: this is **not** the same as your working directory.

???

Now type R.home().

The name of the home directory will be the version you are using.

The home directory is where R will look for the programs and functions it needs.

You working directory is where R will look for your files.


---

## Get to know your R installation.

.your-turn[
What is in R's home directory?
]


```r
list.files(R.home())
```

```
##  [1] "bin"          "COPYING"      "doc"          "etc"         
##  [5] "fontconfig"   "include"      "Info.plist"   "lib"         
##  [9] "library"      "man1"         "modules"      "R"           
## [13] "Rscript"      "share"        "SVN-REVISION" "tests"
```


???

Now do list.files(R.home())

The home directory contains these files and folders. Notice one of these is library. That library is your default library

---

## Get to know your R library

.your-turn[
What is the default R library?
]



```r
.Library
```

```
## [1] "/Library/Frameworks/R.framework/Resources/library"
```

The default library is in the home directory

???

It contains a folder for each package

---

## Get to know your R library

.scroll-output-height[

```r
dir(.Library)
```

```
##   [1] "_cache"            "abind"             "academyapi"       
##   [4] "addmins"           "airports"          "akima"            
##   [7] "animation"         "anytime"           "AsioHeaders"      
##  [10] "askpass"           "assertthat"        "audio"            
##  [13] "available"         "backports"         "BAS"              
##  [16] "base"              "base64enc"         "BayesFactor"      
##  [19] "bayesplot"         "BBmisc"            "beeswarm"         
##  [22] "bench"             "BH"                "BHH2"             
##  [25] "BiocManager"       "bit"               "bit64"            
##  [28] "bitops"            "blob"              "blogdown"         
##  [31] "bookdown"          "boot"              "brew"             
##  [34] "brio"              "broom"             "broom.mixed"      
##  [37] "BRRR"              "bslib"             "cachem"           
##  [40] "callr"             "car"               "carData"          
##  [43] "caret"             "cellranger"        "checklist"        
##  [46] "checkmate"         "cherryblossom"     "class"            
##  [49] "classInt"          "cli"               "cliapp"           
##  [52] "clipr"             "clisymbols"        "cluster"          
##  [55] "coda"              "codetools"         "colorspace"       
##  [58] "colourpicker"      "colourvalues"      "combinat"         
##  [61] "commonmark"        "compiler"          "conflicted"       
##  [64] "conquer"           "contfrac"          "coronavirus"      
##  [67] "corrplot"          "countdown"         "covr"             
##  [70] "cowplot"           "cpp11"             "crancache"        
##  [73] "cranlike"          "crayon"            "credentials"      
##  [76] "crosstalk"         "crul"              "cubature"         
##  [79] "cubelyr"           "curl"              "DAAG"             
##  [82] "data.table"        "datadrivencv"      "datasauRus"       
##  [85] "datasets"          "DBI"               "dbplyr"           
##  [88] "dcurver"           "debugme"           "decor"            
##  [91] "Deriv"             "desc"              "deSolve"          
##  [94] "devtools"          "DiagrammeR"        "dials"            
##  [97] "DiceDesign"        "dichromat"         "diffobj"          
## [100] "digest"            "discrim"           "distro"           
## [103] "doParallel"        "downlit"           "downloader"       
## [106] "dplyr"             "dsbox"             "DT"               
## [109] "dtt"               "dygraphs"          "e1071"            
## [112] "ellipse"           "ellipsis"          "elliptic"         
## [115] "emo"               "enc"               "evaluate"         
## [118] "extrafont"         "extrafontdb"       "fansi"            
## [121] "farver"            "fastmap"           "fastmatch"        
## [124] "fastmatrix"        "filelock"          "fivethirtyeight"  
## [127] "flair"             "flexdashboard"     "flipbookr"        
## [130] "FNN"               "fontawesome"       "fontBitstreamVera"
## [133] "fontLiberation"    "fontquiver"        "forcats"          
## [136] "foreach"           "foreign"           "Formula"          
## [139] "freetypeharfbuzz"  "friends"           "fs"               
## [142] "furrr"             "future"            "future.apply"     
## [145] "fwdbrand"          "gapminder"         "gargle"           
## [148] "gdtools"           "generics"          "genius"           
## [151] "geojsonsf"         "geometries"        "gert"             
## [154] "GGally"            "gganimate"         "ggbeeswarm"       
## [157] "ggdendro"          "ggforce"           "ggformula"        
## [160] "ggfortify"         "gggibbous"         "gghighlight"      
## [163] "ggimage"           "ggmap"             "ggmosaic"         
## [166] "ggpattern"         "ggplot2"           "ggplotify"        
## [169] "ggpubr"            "ggrepel"           "ggridges"         
## [172] "ggsci"             "ggsignif"          "ggstance"         
## [175] "ggtext"            "ggthemes"          "ggthreed"         
## [178] "ggvis"             "gh"                "ghclass"          
## [181] "ghql"              "gifski"            "gistr"            
## [184] "git2r"             "gitcreds"          "gld"              
## [187] "glmnet"            "globals"           "glue"             
## [190] "gmailr"            "gmhelper"          "googledrive"      
## [193] "googlePolylines"   "googlesheets4"     "gower"            
## [196] "GPArotation"       "gpclib"            "GPfit"            
## [199] "gradethis"         "graphics"          "graphql"          
## [202] "grDevices"         "grid"              "gridExtra"        
## [205] "gridGeometry"      "gridGraphics"      "gridtext"         
## [208] "gsheet"            "gssr"              "gt"               
## [211] "gtable"            "gtools"            "gutenbergr"       
## [214] "hardhat"           "haven"             "here"             
## [217] "hexbin"            "highlight"         "highr"            
## [220] "HistData"          "Hmisc"             "hms"              
## [223] "htmlTable"         "htmltools"         "htmlwidgets"      
## [226] "httpcode"          "httpuv"            "httr"             
## [229] "hunspell"          "hypergeo"          "icon"             
## [232] "ids"               "igraph"            "infer"            
## [235] "influenceR"        "ini"               "inline"           
## [238] "ipred"             "iptools"           "isoband"          
## [241] "ISOcodes"          "iterators"         "janeaustenr"      
## [244] "janitor"           "jpeg"              "jqr"              
## [247] "jquerylib"         "jsonify"           "jsonlite"         
## [250] "kableExtra"        "KernSmooth"        "klaR"             
## [253] "knitr"             "L1pack"            "labeling"         
## [256] "labelled"          "Lahman"            "later"            
## [259] "lattice"           "latticeExtra"      "lava"             
## [262] "lazyeval"          "leafem"            "leaflet"          
## [265] "leaflet.extras"    "leaflet.providers" "leafpm"           
## [268] "leafpop"           "leafsync"          "learnr"           
## [271] "learnrhash"        "lexicon"           "lhs"              
## [274] "lifecycle"         "listenv"           "lme4"             
## [277] "lmom"              "loo"               "lpSolve"          
## [280] "lubridate"         "lwgeom"            "magick"           
## [283] "magrittr"          "mapdeck"           "mapedit"          
## [286] "mapproj"           "maps"              "maptools"         
## [289] "mapview"           "markdown"          "MASS"             
## [292] "Matrix"            "MatrixModels"      "matrixStats"      
## [295] "measurements"      "memoise"           "methods"          
## [298] "mgcv"              "microbenchmark"    "mime"             
## [301] "miniCRAN"          "miniUI"            "minqa"            
## [304] "mirt"              "mlr"               "mnormt"           
## [307] "modeldata"         "ModelMetrics"      "modelr"           
## [310] "modeltools"        "mosaic"            "mosaicCore"       
## [313] "mosaicData"        "munsell"           "mvtnorm"          
## [316] "naniar"            "NHANES"            "nlme"             
## [319] "nloptr"            "NLP"               "nnet"             
## [322] "numDeriv"          "nycflights13"      "nycsquirrels18"   
## [325] "oibiostat"         "openintro"         "openssl"          
## [328] "openxlsx"          "ozmaps.data"       "packrat"          
## [331] "pagedown"          "PairedData"        "pak"              
## [334] "paletteer"         "palmerpenguins"    "papaja"           
## [337] "parallel"          "parallelly"        "parallelMap"      
## [340] "ParamHelpers"      "parsedate"         "parsermd"         
## [343] "parsnip"           "patchwork"         "pbapply"          
## [346] "pbkrtest"          "pdftools"          "permute"          
## [349] "pillar"            "pkgbuild"          "pkgcache"         
## [352] "pkgconfig"         "pkgdown"           "pkgload"          
## [355] "plogr"             "plotly"            "plyr"             
## [358] "png"               "polite"            "polyclip"         
## [361] "polynom"           "praise"            "prettycode"       
## [364] "prettyunits"       "prismatic"         "pROC"             
## [367] "processx"          "prodlim"           "productplots"     
## [370] "profmem"           "profvis"           "progress"         
## [373] "promises"          "pryr"              "ps"               
## [376] "psych"             "purrr"             "qpdf"             
## [379] "quantreg"          "questionr"         "R.cache"          
## [382] "R.methodsS3"       "R.oo"              "R.utils"          
## [385] "R6"                "ragg"              "ranger"           
## [388] "RANN"              "rapidjsonr"        "rappdirs"         
## [391] "raster"            "ratelimitr"        "rcmdcheck"        
## [394] "RColorBrewer"      "Rcpp"              "RcppArmadillo"    
## [397] "RcppEigen"         "RcppParallel"      "RCurl"            
## [400] "reactable"         "reactlog"          "reactR"           
## [403] "readr"             "readxl"            "recipes"          
## [406] "RefManageR"        "regexplain"        "rematch"          
## [409] "rematch2"          "remotes"           "renv"             
## [412] "repr"              "reprex"            "reshape"          
## [415] "reshape2"          "revdepcheck"       "rex"              
## [418] "rgdal"             "rgeos"             "RgoogleMaps"      
## [421] "rhub"              "rio"               "rJava"            
## [424] "rjson"             "rLakeAnalyzer"     "rlang"            
## [427] "rmarkdown"         "rmdfiltr"          "robotstxt"        
## [430] "ROSE"              "roxygen2"          "roxygen2md"       
## [433] "rpart"             "rprojroot"         "rsample"          
## [436] "rscloud"           "rsconnect"         "RSQLite"          
## [439] "rstan"             "rstanarm"          "rstantools"       
## [442] "rstatix"           "rstudioapi"        "rticles"          
## [445] "Rttf2pt1"          "rtweet"            "rvcheck"          
## [448] "rversions"         "rvest"             "sass"             
## [451] "satellite"         "scales"            "schrute"          
## [454] "scico"             "selectr"           "servr"            
## [457] "sessioninfo"       "sf"                "sfheaders"        
## [460] "shape"             "shiny"             "shinyBS"          
## [463] "shinycssloaders"   "shinydashboard"    "shinyjs"          
## [466] "shinystan"         "shinythemes"       "shinyWidgets"     
## [469] "showtext"          "showtextdb"        "skimr"            
## [472] "slam"              "slider"            "snakecase"        
## [475] "SnowballC"         "sourcetools"       "sp"               
## [478] "SparseM"           "spatial"           "spatialwidget"    
## [481] "spelling"          "spiderbar"         "splines"          
## [484] "splus2R"           "SQUAREM"           "StanHeaders"      
## [487] "stars"             "Stat2Data"         "statmod"          
## [490] "stats"             "stats4"            "statsr"           
## [493] "stopwords"         "stringdist"        "stringi"          
## [496] "stringr"           "styler"            "sugrrants"        
## [499] "suncalc"           "survival"          "svglite"          
## [502] "sys"               "sysfonts"          "systemfonts"      
## [505] "syuzhet"           "tcltk"             "tesseract"        
## [508] "testthat"          "textdata"          "textrecipes"      
## [511] "textshape"         "textshaping"       "thematic"         
## [514] "themis"            "threed"            "threejs"          
## [517] "tibble"            "tidymirt"          "tidymodels"       
## [520] "tidyposterior"     "tidypredict"       "tidyr"            
## [523] "tidyselect"        "tidytemplate"      "tidytext"         
## [526] "tidytuesdayR"      "tidyverse"         "timeDate"         
## [529] "tinytex"           "tm"                "tmap"             
## [532] "tmaptools"         "TMB"               "Tmisc"            
## [535] "tmvnsim"           "tokenizers"        "tools"            
## [538] "topicmodels"       "transformr"        "translations"     
## [541] "triebeard"         "tufte"             "tune"             
## [544] "tweenr"            "udapi"             "ukbabynames"      
## [547] "unbalanced"        "uni"               "units"            
## [550] "unvotes"           "UpSetR"            "urltools"         
## [553] "usdata"            "usethis"           "utf8"             
## [556] "utf8splain"        "utils"             "uuid"             
## [559] "V8"                "vctrs"             "vdiffr"           
## [562] "vegan"             "vembedr"           "vip"              
## [565] "vipor"             "viridis"           "viridisLite"      
## [568] "visdat"            "visNetwork"        "vroom"            
## [571] "waffle"            "waiter"            "waldo"            
## [574] "warp"              "webshot"           "websocket"        
## [577] "whisker"           "whoami"            "widgetframe"      
## [580] "withr"             "wordcloud"         "wordcloud2"       
## [583] "workflows"         "wqTools"           "writexl"          
## [586] "xaringan"          "xaringanExtra"     "xaringanthemer"   
## [589] "xfun"              "xkcd"              "XLConnect"        
## [592] "xlsx"              "xlsxjars"          "XML"              
## [595] "xml2"              "xopen"             "xtable"           
## [598] "xts"               "yaml"              "yardstick"        
## [601] "yesno"             "zip"               "zoo"
```
]

---

## Get to know your R library

.your-turn[
What libraries does R know about?
]


```r
.libPaths()
```

```
## [1] "/Library/Frameworks/R.framework/Versions/4.0/Resources/library"
```


???
How many libraries do you have access to? Post in chat

In my case I have the default library where all the packages that come with the base distribution go.

I also have a user level library where I can install other packages.

---

## Get to know your R library.

For many R users `.Library` and `.libPaths()` are the same.  

--

Other R users maintain, or have access to, multiple libraries.



--
.tip[
You may not have write access to the default library.
]

???
If you are working on a work machine or networked machine you may not have write access to the default library. That is, if someone else had to install R and Rstudio on the machine you are using, the chances are you won't have access.


---

## Where do R packages come from?

&lt;img src="images/stork.png" title="cartoon of a stork with baby suspended in  blanket from its beak" alt="cartoon of a stork with baby suspended in  blanket from its beak" width="400px" style="display: block; margin: auto;" /&gt;

???

Add speaker notes

---

## Where do R packages come from?

CRAN:

```r
install.packages("praise")
```

GitHub:

```r
remotes::install_github("rladies/praise")
```

Bioconductor

```r
BiocManager::install("celaref")
```

???

CRAN and GitHub, mostly but also some specialised package repositories such as Bioconductor.
You can often find the latest features for a package in development on GitHub. Some packages never make it to CRAN. Not necessarily 'bad' packages, the author just hasn't done the paperwork required.

To install to a particular library:

install.packages("praise", lib = library)

withr::with_libpaths(library, install_github("gaborcsardi/praise"))

---

## Your installed packages

.your-turn[
How many packages do you have installed?
]

```r
dim(installed.packages())
```

```
## [1] 601  16
```
--
The output of `installed.packages()` is a matrix; each row is a package

--

I have 601 packages installed

???

Post how many packages you have installed to chat.

Don't delete packages you don't recognise - they may be important for other packages.

---

## Your installed packages

.your-turn[
View the matrix of installed packages
]

```r
View(installed.packages())
```
???

You can see which library a package is installed in 

---

## Your installed packages

The columns give some information about each package:


```r
colnames(installed.packages())
```

```
##  [1] "Package"               "LibPath"              
##  [3] "Version"               "Priority"             
##  [5] "Depends"               "Imports"              
##  [7] "LinkingTo"             "Suggests"             
##  [9] "Enhances"              "License"              
## [11] "License_is_FOSS"       "License_restricts_use"
## [13] "OS_type"               "MD5sum"               
## [15] "NeedsCompilation"      "Built"
```

???

These column are documentations says what a package needs to work.

Depends is used to indicate dependency on a particular version of R, and on packages that are to be loaded (with library()) whenever your package is loaded. 

Imports is used for packages that are needed by a package but that don‚Äôt need to be loaded with library(). Any package listed in Imports will need to be installed with your package

Suggests is for packages that aren‚Äôt really necessary, but that are used in  examples, vignettes, or tests. Packages listed in Suggests do not need to be installed with your package.

When writing a package, these are things that need to be included

---

## Startup files

.pull-left[

`.Rprofile`

Code that runs at startup
 - Load workflow packages
 - Set options
 - Use in moderation!
 ]
 
.pull-right[
`.Renviron`

Settings for R
 - Set library paths
 - Set environment variables
]

???

Help you manage your library paths (amongst other things).
You will edit these in set up.

---

class: middle, inverse

# Developing a script vs developing a package

???
We now have more understanding of what packages are and where they come from and live on your computer. Now we will consider the differences between developing a script and developing a package


---

## Different

.pull-left-narrow[
.hand[.blue[Script]]

-  one-off data analysis
-  defined by `.R` extension
-  `library()` calls
-  documentation in `#` comments
-  `source()`
]

.pull-right-wide[
.hand[.blue[Package]]
-  defines reusable components
-  defined by presence of `DESCRIPTION` file
-  Required packages specified in `DESCRIPTION`, made available in `NAMESPACE` file
-  documentation in files and `Roxygen` comments
-  Install and restart
]


???

When you are writing a script you load packages with a library() call and document your code with comments using a #. The code is used for a one-off analysis and is stored in a .R file. The code is one off in the sense that it directly references your dataframes and variables

When you write a package, your code is written to be reusable - functions are generalisable - their argument types are defined by the exact instance is not.
A package is defined by the presence of a DESCRIPTION file (at least in RStudio).
It is in this file that you say what the package does, who wrote it and what dependencies it has. Required packages are made available not through a library call, but through the NAMESPACE file. 
As this hints at, the documentation is different - their is package and function level documentation.

---

## Same

Iterate early and often!  

Change it, try it, change it, try it, 

???

However, the logic of the process is similar. You write something, try it out, change it, try it out, change it. A lot.

---

class: middle, inverse

# Explore!

---

## Explore

.your-turn[
Look at [Stephanie Kirmer's](https://github.com/skirmer) demo package [here](https://github.com/forwards/workshops/tree/master/Chicago2019/demoPackage)

-  Where‚Äôs the R code? What is it mostly comprised of?
-  What do you think is in the DESCRIPTION file? 
-  How about the NAMESPACE file?

]
???
Mainly comments in the form:
#' goToTheZoo

DESCRIPTION has package metadata. The presence of this file is what makes and RStudio Project a package. 
NAMESPACE gives the functions imported and exported

This looks like a lot of files to get right! Fortunately the devtools approach will make most of this automatically!

---

class: middle, inverse

# Package states

---

## Package states

There are five states a package can be in:
-  source

-  bundled

-  binary

-  installed

-  in-memory

???

Having a understanding of the different states a package can be in is helpful in understanding package development. 

---

&lt;img src="images/annotated_installation.png" title="schematic of package states and the functions that move them between states. One the horizontal axis: source, bundle, binary, installed, in memory. One the vertical axis the functions install.packages, R CMD install, install, build, install_github" alt="schematic of package states and the functions that move them between states. One the horizontal axis: source, bundle, binary, installed, in memory. One the vertical axis the functions install.packages, R CMD install, install, build, install_github" width="870px" style="display: block; margin: auto;" /&gt;

.tiny[
Figure from [R Packages](https://r-pkgs.org/) 
https://github.com/hadley/r-pkgs/blob/master/diagrams/installation.png
]

???

when you develop a package, you write Source code. When you use a package you use it is in the memory.

Functions moved packages between states.

You already know some of the functions move packages between states. For example, `install.packages()` and `remotes::install_github()` move a package from source, bundled, or binary states into the installed state. 

The `library()` function loads an installed package into memory, making it available for immediate and direct use.

---

## Package states

.pull-left-narrow[
-  .tip[source]

-  bundled

-  binary

-  installed

-  in-memory
]

.pull-right-wide[
.tip[
What you create and work on.

Specific directory structure with some particular components e.g., `DESCRIPTION`, an `R/` directory.

We examined the source of the demoPackage

]
]

???

Now we examine these states in a little more detail.
---

## Package states

.your-turn[
Visit the CRAN landing page for `readxl`:  https://cran.r-project.org/package=readxl 

And the GitHub repository where `readxl` is developed in the open: 
https://github.com/tidyverse/readxl
]

???

Encourage people to do this if there is time.



---

## Package states

.pull-left-narrow[
-  source

-  .tip[bundled]

-  binary

-  installed

-  in-memory
]

.pull-right-wide[
.tip[

Also known as "source tarballs".

Package files compressed to single file.

Conventionally `.tar.gz`

You don't normally need to make one.

Unpacked it looks very like the source package
]
]

???

In the rare case that you need to make a bundle from a package you‚Äôre developing locally, use devtools::build(). Under the hood, this calls pkgbuild::build() and, ultimately, R CMD build, which is described further in the Building package tarballs section of Writing R Extensions.

---

## Package states

.pull-left-narrow[
-  source

-  bundled

-  .tip[binary]

-  installed

-  in-memory
]

.pull-right-wide[
.tip[

Package distribution for users w/o dev tools

Also a single file

Platform specific: `.tgz` (Mac) `.zip` (Windows)

Package developers submit a bundle to CRAN; CRAN makes and distributes binaries

`install.packages()` 
]
]

???

A package in binary form is Platform specific.
If you write a package for distribution on CRAN, you submit a bundle to CRAN then CRAN makes and distributes binaries


`install.packages()` is usually downloading the binary

To understand the difference between package bundle and a package binary see https://r-pkgs.org/package-structure-state.html

---

## Package states

.pull-left-narrow[
-  source

-  bundled

-  binary

-  .tip[installed]

-  in-memory
]

.pull-right-wide[
.tip[
A binary package that‚Äôs been decompressed into a package library

Command line tool `R CMD INSTALL` powers all package installation
]
]

???

Add speaker notes
---

&lt;img src="images/installation.png" title="schematic of package states and the functions that move them between states. One the horizontal axis: source, bundle, binary, installed, in memory. One the vertical axis the functions install.packages, R CMD install, install, build, install_github" alt="schematic of package states and the functions that move them between states. One the horizontal axis: source, bundle, binary, installed, in memory. One the vertical axis the functions install.packages, R CMD install, install, build, install_github" width="900px" style="display: block; margin: auto;" /&gt;

There's more than one route (tool) for installation.

.tiny[
Figure from [R Packages](https://r-pkgs.org/) 
https://github.com/hadley/r-pkgs/blob/master/diagrams/installation.png
]

???


---

## Package states

.pull-left-narrow[
-  source

-  bundled

-  binary

-  installed

-  .tip[in-memory]
]

.pull-right-wide[
.tip[

If a package is installed `library()` makes its function available by loading the package into memory and attaching it to the search path.

We do not use `library()` for packages we are working on

`devtools::load_all()` loads a source package directly into memory.
]
]

???

Add speaker notes

---
class: middle, inverse

# Workflow


???
What is the workflow we use in writing packages?
---

## Workflow

&lt;img src="images/annotated_load_all.png" title="schematic of package states: source, bundle, binary, installed, in memory. It shows the load_all() function making a direct line from source to in-memory" alt="schematic of package states: source, bundle, binary, installed, in memory. It shows the load_all() function making a direct line from source to in-memory" width="800px" style="display: block; margin: auto;" /&gt;


`devtools::load_all()` is to package development  

as  

interactive ‚Äústepping through‚Äù code is to script development

???

devtools::load_all() simulates package installation, i.e., it puts the package in to memory.
---

# Workflow

&lt;img src="images/annotated_install_and_restart.png" title="schematic of package states: source, bundle, binary, installed, in memory. It shows Install and Restart making a direct line from source to installed and then installed to in-memory" alt="schematic of package states: source, bundle, binary, installed, in memory. It shows Install and Restart making a direct line from source to installed and then installed to in-memory" width="800px" style="display: block; margin: auto;" /&gt;


RStudio‚Äôs Install &amp; Restart is to package development

as

`source()` is to script development

???

Add speaker notes

---

## Workflow

Use `devtools::load_all( )` a lot!  

(And ‚ÄúInstall and Restart‚Äù sparingly)


???

Add speaker notes

---

class: middle, inverse

# Approach


---

## Approach

We follow the approach used in [R Packages](https://r-pkgs.org/) :

-  uses `devtools` 
-  in RStudio
-  version controlled using git
-  hosted on GitHub

???

This approach makes package development a little easier by automating some of the steps, i.e., there are packages to make package development easier! 
---
class: middle, inverse

# Summary

---

## Summary

-  packages allow you to generalise, test, document and share your code
-  packages come from CRAN and GitHub (mainly) but some other specialised repositories
-  they live in libraries (folders) on your pc
-  you write source, submit bundles, install binaries (mainly), and use in-memory
-  we use `devtools::load_all()` during development a lot

???

Add speaker notes

---

class: middle, inverse

# Where next?

---

## Where next?

R Forwards modules

-  [Setting up your system](https://www.eventbrite.co.uk/e/r-forwards-package-development-module-setting-up-your-system-tickets-132115790887)
-  [Your first package!](https://www.eventbrite.co.uk/e/r-forwards-package-development-module-your-first-package-tickets-132115738731)

Other sources
-  [Writing R Extensions](https://cran.r-project.org/doc/manuals/R-exts.html) 1999‚Äì2020 R Core Team
-  [R Packages](https://r-pkgs.org/) 
-  Hillary Parker's [Writing an R package from scratch](https://hilaryparker.com/2014/04/29/writing-an-r-package-from-scratch/)
-  Karl Broman's [R package primer a minimal tutorial](https://kbroman.org/pkg_primer/)

???
Setting up your system sign up close 1800 GMT Monday
Your first package! sign up close 1800 GMT Tuesday

note - Writing R Extensions is not a tutorial, it's a reference. I was directed here years ago and decided I couldn't write a package. Then, a few years later, I read Hilary Parker's post.

---

class: middle, inverse

# What questions do you have?

---

class: middle, inverse

# Acknowledgements

---

Slides made with: **`knitr`** ,**`R Markdown`** , **`xaringan`** , **`xaringanthemer`** , **`xaringanExtra`** , **`countdown`** . 

Referencing with **`RefManageR`** .

Designed by: [Mine √áetinkaya-Rundel](https://twitter.com/minebocek) and [Emma Rand](https://twitter.com/er13_r)

---

## References

.small[
NULL
]

---

## References

.small[
NULL
]

---

## References

.small[
NULL
]

---

## License

&lt;a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"&gt;&lt;img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /&gt;&lt;/a&gt;&lt;br /&gt;&lt;span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"&gt;Package Development Module: Packages in a nutshell&lt;/span&gt; by &lt;span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName"&gt;Forwards&lt;/span&gt; is licensed under a &lt;a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"&gt;Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License&lt;/a&gt;.
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightLines": true,
"highlightStyle": "github",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
