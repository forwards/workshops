<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Zero to Hero</title>
    <meta charset="utf-8" />
    <meta name="author" content="Forwards Teaching Team" />
    <link href="libs/font-awesome-5.3.1/css/fontawesome-all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../../libs/remark-css/default.css" type="text/css" />
    <link rel="stylesheet" href="extra.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Zero to Hero
### Forwards Teaching Team<br><br><img src='../../pics/forwards_296x296.png' alt='Forwards logo' width='100'>
### <br><i class="fab  fa-twitter "></i> <a href="https://twitter.com/R_Forwards">@R_Forwards</a><br><a href="https://forwards.github.io/" class="uri">https://forwards.github.io/</a>
### <br> updated: 2020-03-09

---





class: inverse center middle

# What can R do?

---

&lt;br&gt;
&lt;div style="padding: 0;float: left;width: 45%;text-align:center; border:2px solid;"&gt;

Data Management  

&lt;br&gt;
&lt;table class="GeneratedTable" width="90%" style="margin:10px auto"&gt;
       &lt;td&gt;Data Import&lt;/td&gt;
       &lt;td&gt;&lt;img height = "180px" src="DataImport.png"&gt;&lt;br&gt;&lt;/td&gt;
  &lt;/table&gt;
    &lt;table class="GeneratedTable" width="90%" style="margin:10px auto"&gt;
       &lt;td&gt;Reshaping&lt;/td&gt;
      &lt;td&gt;&lt;img height = "150px" src="TidyingData.png"&gt;&lt;br&gt;&lt;/td&gt;
  &lt;/table&gt;
  &lt;/div&gt;
  
&lt;div style="padding: 0;float: left;width:50%;text-align:center;border:2px solid;margin-left:20px"&gt;

Data Analysis  

&lt;br&gt;
&lt;table class="GeneratedTable" width="90%" style="margin:10px auto"&gt;
       &lt;td&gt;Explaratory Data Analysis&lt;/td&gt;
       &lt;td&gt;&lt;img height = "130px" src="eda.png"&gt;&lt;br&gt;&lt;/td&gt;
  &lt;/table&gt;
    &lt;table class="GeneratedTable" width="90%" style="margin:10px auto"&gt;
       &lt;td&gt;Statistical Modelling&lt;/td&gt;
      &lt;td&gt;&lt;img height = "130px" src="statmodelling.png"&gt;&lt;br&gt;&lt;/td&gt;
     &lt;tr&gt;
  &lt;/table&gt;
    &lt;table class="GeneratedTable" width="90%" style="margin:10px auto"&gt;
       &lt;td&gt;Advanced Statistics&lt;/td&gt;
      &lt;td&gt;&lt;img height = "130px" src="wordcloud.png"&gt;&lt;br&gt;&lt;/td&gt;
  &lt;/table&gt;
  &lt;/div&gt;
  
---

&lt;br&gt;
&lt;div style="padding: 0;float: left;width: 50%;text-align:center; border:2px solid;"&gt;

Reporting

&lt;br&gt;
&lt;table class="GeneratedTable" width="90%" style="margin:10px auto"&gt;
       &lt;td&gt;Dashboard&lt;/td&gt;
       &lt;td&gt;&lt;img height = "180px" src="dashboard.png"&gt;&lt;br&gt;&lt;/td&gt;
         &lt;/table&gt;
       &lt;table class="GeneratedTable" width="90%" style="margin:10px auto"&gt;
       &lt;td&gt;Markdown&lt;/td&gt;
      &lt;td&gt;&lt;img height = "200px" src="markdown.png"&gt;&lt;br&gt;&lt;/td&gt;
     &lt;tr&gt;
  &lt;/table&gt;
  &lt;/div&gt;
  
&lt;div style="padding: 0;float: left;width:45%;text-align:center;border:2px solid;margin-left:20px"&gt;

Programming
&lt;br&gt;
&lt;table class="GeneratedTable" width="90%" style="margin:10px auto"&gt;
       &lt;td&gt;Connect to other languages&lt;/td&gt;
       &lt;td&gt;&lt;img height = "180px" src="java.png"&gt;&lt;br&gt;&lt;/td&gt;
  &lt;/table&gt;
    &lt;table class="Packages" width="90%" style="margin:10px auto"&gt;
       &lt;td&gt;Packages&lt;/td&gt;
      &lt;td&gt;&lt;img height = "130px" src="packages.png"&gt;&lt;br&gt;&lt;/td&gt;
     &lt;tr&gt;
  &lt;/table&gt;
  &lt;/div&gt;
---

# The R Ecosystem

&lt;div style="padding: 0;float: left;width: 32%;text-align:center;border:2px solid;"&gt;

Base &lt;img height = "20px" src="Rlogo.png"&gt;

&lt;br&gt;
&lt;table class="GeneratedTable" width="90%" style="margin:20px auto"&gt;
     &lt;tr&gt;
       &lt;td&gt;base&lt;/td&gt;
     &lt;/tr&gt;
     &lt;tr&gt;
       &lt;td&gt;create R objects&lt;br&gt;summaries&lt;br&gt;math functions&lt;/td&gt;
     &lt;tr&gt;
  &lt;/table&gt;
    &lt;table class="GeneratedTable" width="90%" style="margin:40px auto"&gt;
     &lt;tr&gt;
       &lt;td&gt;recommended&lt;/td&gt;
     &lt;/tr&gt;
     &lt;tr&gt;
       &lt;td&gt;statistics&lt;br&gt;graphics&lt;br&gt;example data&lt;/td&gt;
     &lt;tr&gt;
  &lt;/table&gt;
  &lt;/div&gt;
  
&lt;div style="padding: 0;float: left;width:62%;text-align:center;border:2px solid;margin-left:20px"&gt;
  
  Contributed Packages

&lt;div style="center;display:flex; justify-content:center"&gt;
  &lt;table class="GeneratedTable" width = "40%" style="margin:20px auto"&gt;
     &lt;tr&gt;
       &lt;td&gt;CRAN &lt;img height = "20px" src="Rlogo.png"&gt;&lt;br&gt;&lt;a href="https://cran.r-project.org"&gt;cran.r-project.org&lt;/a&gt;&lt;/td&gt;
     &lt;/tr&gt;
     &lt;tr&gt;
       &lt;td&gt;main repos&lt;br&gt;~13000 pkgs&lt;/td&gt;
     &lt;tr&gt;
  &lt;/table&gt;
    &lt;table class="GeneratedTable" width = "40%" style="margin:20px auto"&gt;
     &lt;tr&gt;
       &lt;td&gt;&lt;img height = "29px" src= "bioconductor_logo_rgb.jpg"&gt;&lt;br&gt;&lt;a href="https://www.bioconductor.org"&gt;bioconductor.org&lt;/a&gt;&lt;/td&gt;
     &lt;/tr&gt;
     &lt;tr&gt;
       &lt;td&gt;bioinformatics&lt;br&gt;&gt;1500 pkgs&lt;/td&gt;
     &lt;tr&gt;
  &lt;/table&gt;
  &lt;/div&gt;

  &lt;table class="GeneratedTable" width = "40%" style="margin:20px auto 40px"&gt;
     &lt;tr&gt;
       &lt;td&gt;GitHub &lt;img height = "20px" src="githublogo.png"&gt;&lt;br&gt;&lt;a href="https://github.com"&gt;github.com&lt;/a&gt;&lt;/td&gt;
     &lt;/tr&gt;
     &lt;tr&gt;
       &lt;td&gt;devel pkgs&lt;br&gt;GitHub-only pkgs&lt;/td&gt;
     &lt;tr&gt;
  &lt;/table&gt;

&lt;/div&gt;

---

class: inverse center middle

# Using R

---

# R Demo

We can type commands directly into the R console


```r
3 + 4
?"+" #look up help for "+"
x &lt;- 3 + 4 ; y &lt;- log(x) 
ls() # list of objects in the current workspace
rm(x)
data() # find out what standard data sets there are
plot(iris) # plot Fisher's iris data
```

---

class: inverse center middle

# Using RStudio

---

# RStudio IDE

![:width RStudio screenshot, 80%](RStudio.png)

---

# R Studio Features

Features provided by RStudio include:

 - syntax highlighting, code completion, smart indentation
 - interactively send code chunks from editor to R
 - organise multiple scripts, help files, plots 
 - search code and help files

---

# RStudio Shortcuts from the R Console

RStudio provides a few shortcuts to help write code in the R console

 - &lt;kbd title = "up arrow"&gt;&amp;#x2191;&lt;/kbd&gt;/&lt;kbd title = "down arrow"&gt;&amp;#x2193;&lt;/kbd&gt; go back/forward through history one command at a time
 - &lt;kbd&gt;Ctrl&lt;/kbd&gt;/&lt;kbd title = "command"&gt;&amp;#8984;&lt;/kbd&gt; + &lt;kbd title = "up arrow"&gt;&amp;#x2191;&lt;/kbd&gt; review recent history and select command
 - &lt;kbd&gt;Tab&lt;/kbd&gt; view possible completions for part-written expression

Code completion (using &lt;kbd&gt;Tab&lt;/kbd&gt;) is also provided in the source editor

---

# R Scripts

Text files saved with a `.R` suffix are recognised as R code.
  
Code can be sent directly from the source editor as follows

 - &lt;kbd&gt;Ctrl&lt;/kbd&gt;/&lt;kbd title = "command"&gt;&amp;#8984;&lt;/kbd&gt; + &lt;kbd title = "enter"&gt;&amp;#8629;&lt;/kbd&gt; or &lt;img alt="Run button" src = "run_button.png" height = "30px" style="vertical-align: middle;"&gt; run current line
   - run multiple lines by selecting first
 - &lt;kbd&gt;Ctrl&lt;/kbd&gt;/&lt;kbd title = "command"&gt;&amp;#8984;&lt;/kbd&gt; + &lt;kbd&gt;Shift&lt;/kbd&gt; + &lt;kbd title = "enter"&gt;&amp;#8629;&lt;/kbd&gt; or &lt;img alt="Source button" src = "source_button.png" height = "30px" style="vertical-align: middle;"&gt;. Run the script from start to finish.
 
---

# RStudio Demo


```r
View(iris)
# showing code completion, running code, indentation
sum(3, 4)
summary(iris, maxsum = 2, 
        digits = 2)
pbirthday(40, classes = 365, coincident = 3)
```

???

Show how to change background so not white

---

# Why R Scipts

Writing an R script for an analysis has several
advantages over a graphical user interface (GUI)

- it provides a *record* of the exact approach used
in an analysis
- it enables the analysis to be easily *reproduced*
and modified
- it allows greater control

---

# Good Practices for R Scripts

Organising your R script well will help you and others understand and use 
it. 

- Add comment or two at start to describe purpose of script
- Load required data and packages at the start
- Avoid hard-coding: define variables such as file paths early on
- Give functions and variable meaningful names
- use `###` or `#---` to separate sections (in RStudio Code &gt; Insert Section)

---

# Your Turn!

In RStudio, open a new R Script.

Try typing some of the code from the R/R Studio demo and using some of the 
shortcuts to complete your commands and run them.

---

class: inverse center middle

# Working with Data in R

---

# Data Structures 

Data structures are the building blocks of code. In
R there are four main types of structure:

- vectors and factors
- matrices and arrays
- lists
- data frames

The first and the last are sufficient to get started.

---

# Vectors

A single number is a special case of a numeric vector. Vectors of length greater than one can be created using the concatenate function, `c`.

```r
x &lt;- c(1, 3, 6)
```

The elements of the vector must be of the same type: common types are numeric, character and logical

```r
x &lt;- 1:3
x
```

```
# [1] 1 2 3
```

```r
y &lt;- c("red", "yellow", "green")
y
```

```
# [1] "red"    "yellow" "green"
```

```r
z &lt;- c(TRUE, FALSE)
```
Missing values (of any type) are represented by the symbol `NA`.

---

# Data Frames

Data sets are stored in R as *data frames*. These are structured as a list
of objects, typically vectors, of the same length


```r
str(iris)
```

```
# 'data.frame':	150 obs. of  5 variables:
#  $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
#  $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
#  $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
#  $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
#  $ Species     : Factor w/ 3 levels "setosa","versicolor",..: 1 1 1 1 1 1 1 1 1 1 ...
```

Here `Species` is a factor, a special data structure for categorial
variables.

---

# Creating a Data Frame


```r
x &lt;- 1:3
y &lt;- c("red", "yellow", "green")
mydata &lt;- data.frame(x, y)
mydata
```

```
#   x      y
# 1 1    red
# 2 2 yellow
# 3 3  green
```


---

# Install Packages

Most day-to-day work will require at least one contributed package.

CRAN packages can be installed from the Packages tab

![:width install packages menu button, 40%](install_packages.png)

Alternatively, they can be installed directly via `install.packages()`


```r
install.packages("survival", dependencies = TRUE)
```

---

# Using Packages

To use an installed package in your code, you must first load it from your package library


```r
library(survival)
```

Sometimes an RStudio feature will require a contributed package. A pop-up will ask permission to install the package the first time, after that RStudio will load it automatically.

---

# Data Input via Import Dataset

Using the Import Dataset dialog in RStudio 

![:width Import Dataset button, 30%](import_dataset.png)

we  can import files stored locally or online in the following formats:

- `.txt`/`.csv` via `read_delim`/`read_csv` from **readr**.
- `.xlsx` via `read_excel` from **readxl**.
- `.sav/.por` , `.sas7bdat` and `.dta` via `read_spss`, `read_sas` and
`read_stata` respectively from **haven**.

Most of these functions also allow files to be compressed, e.g. as `.zip`.

---

# Your Turn

Use the Import Dataset button, import a data set from the `data sets` 
folder of the workshop materials. RStudio will ask to install packages as 
required.

Try changing some of the import options to see how that changes the preview of 
the data and the import code.

Install the **skimr** package and use the `skim` function to summarise the 
data set.

---

# Tibbles

The functions used by *Import Dataset* return data frames of
class `"tbl_df"`, aka **tibbles**. The main differences are

|     |    data.frame  |   tibble   |
|:---:|:--------------:|:----------:|
| Printing &lt;br&gt; (default) | Whole table | 10 rows; columns to fit &lt;br&gt; Prints column type |
| Subsetting | `dat[, 1]`, `dat$X1`, `dat[[1]]` &lt;br&gt; all return vector | `dat[,1]` returns tibble &lt;br&gt;  `dat$X1`, `dat[[1]]` return vector |
| Strings | Converted to factor (default) | Left as character |
| Variable names | Made *syntactically valid* &lt;br&gt; e.g. `Full name` -&gt; `Full.name` | Left as is &lt;br&gt; use e.g. ``dat$`Full name`` ` |

---

# Data Input via Code

The **rio** package provides a common interface to the functions used by 
*Import Dataset* as well as many others.

The data format is automatically recognised from the file extension. To
read the data in as a tibble, we use the setclass argument.


```r
library(rio)
compsci &lt;- import("compsci.csv", setclass = "tibble")
cyclist &lt;- import("cyclist.xlsx", setclass = "tibble")
```

See `?rio` for the underlying functions used for each format and the
corresponding optional arguments, e.g. the skip argument to
`read_excel` to skip a certain number of rows.

---

class: inverse center middle

# Workflow

---

# R Studio Projects

An Rstudio project is a context for work on a specific project

- automatically sets working directory to project root
- has separate workspace and command history
- works well with version control via git or svn

.pull-left-66[
Create a project from a new/existing directory via the File Menu or the New Project button

Switch project, or open a different project in a new RStudio instance via the Project menu.
]
.pull-right-33[
![:width New Project button, 60%](project_button.png)
&lt;br&gt;
![:width Project menu, 100%](project_menu.png)
]

---

# Project Structure

An R project structure helps you kickstart the project you undertake as 
fast as possible, using a standardized form.

A typical project can be organised into folders such as `data`, 
`scripts`, `results` and `reports`.

The scripts should be named to reflect the content/function:
- requirements.R = includes required packages
- functions.R = includes custom functions
- custom_theme.R = includes a custom theme to create graphs
- analysis.R = main analysis script

A README file can be used to describe the project and the files.

---

# R Markdown Documents

R markdown documents (`.Rmd`) intersperse code chunks (R, Python, Julia, C++, SQL) with markdown text 



.box[
.column-left[
YAML header
]
.column-right[

```yaml
---
title: "Report"
output: html_document
---
```

]
.column-left[
Markdown text
]
.column-right[

```markdown
## First section 

This report summarises the `cars` dataset.
```
]
.column-left[
R code chunk
]
.column-right[
````r
```{r summary-cars}
summary(cars)
```
````
]
]

---

# Rendering

The `.Rmd` file can be rendered to produce a document (HTML, PDF, docx) integrating the code output.

&lt;center&gt;
&lt;iframe src="example.html" width="50%" height="400px"&gt;
&lt;/center&gt;

Options can be controlled on a document or chunk level 
whether to show code and/or output.

???

Demo with standard .Rmd template  (File &gt; New R markdown)

---

# Markdown Reference

You can use markdown to format text, create bulleted lists, tables and more.

RStudio provides a quick reference:
![:width New Project button, 50%](../../pics/markdown_quick_reference.png)

---

# Your Turn

Copy the `infant` directory from the workshop materials to your laptop. Open
`infant.Rproj`, which is an RStudio project file.

From the Files tab, open the `infant.Rmd` R markdown file. 

In the `setup` chunk, write some code to load the **rio** package.

In the chunk labelled `import-data`, write some code that will import the 
`infant.xlsx` file and create a tibble named `infant`. *Hint* use the `import` 
function from the **rio** package.

Run the code in the `import-data` chunk (the `setup` chunk is run 
automatically). Use `View()` in the console to inspect the result.



---

class: inverse center middle

# Data Wrangling

---

# Data Pre-processing

The imported data are a subset of records from a US Child Health and 
Development Study, corresponding to live births of a single male foetus. 

The data requires a lot of pre-processing
 - converting numeric variables to factors
 - converting coded values to missing values
 - filtering rows and selecting columns
 
The **dplyr** package can be used to help with many of these steps

---

# dplyr

The **dplyr** package provides the following key functions to operate on
data frames

 - `filter()`
 - `arrange()`
 - `select()` (and `rename()`)
 - `distinct()`
 - `mutate()` (and `transmute()`)
 - `summarise()`

---

# `filter()`

`filter()` selects rows of data by criteria


```r
library(dplyr)
infant &lt;- filter(infant, smoke != 9 &amp; age &gt; 18)
```
&lt;br&gt;

| Building block     | R code                          |
|:-------------------|---------------------------------|
| Binary comparisons |`&gt;`, `&lt;`, `==`, `&lt;=`, `&gt;=`, `!=` |
| Logical operators  |or &lt;code class="remrk-inline-code"&gt;&amp;#124;&lt;/code&gt; and `&amp;`, not `!`    |
| Value matching     |e.g. `x %in% 6:9`                |
| Missing indicator  |e.g. `is.na(x)`                  |


---

# `select()` 

`select()` selects variables from the data frame.

Select named columns:


```r
select(infant, gestation, sex)
```

Select a sequence of columns, along with an individual column


```r
select(infant, pluralty:gestation, parity)
```

Select all columns *except* specified columns


```r
select(infant, -(id:outcome), -sex)
```

---

# `mutate()`

`mutate()` computes new columns based on existing columns. Re-using
an existing name replaces the old variable. For example we can convert 
the mother's weight from pounds to kilograms


```r
mutate(infant, 
       wt = ifelse(wt == 999, NA, wt),
       wt = wt * 0.4536)
```

To only keep the computed columns, use `transmute()` in place of 
`mutate()`.

---

# Your Turn

In the `select-variables` chunk, use `select()` to remove the redundant 
variables `pluralty`, `outcome` and `sex`, as well as characteristics of 
the father `drace`, ... , `dwt`. Over-write the `infant` data frame.

The variable `gestation` gives the length of the pregnancy in days. In 
the `filter-variables` chunk, filter  the data to exclude extremely 
premature babies (gestation less than 28 weeks) and extremely late babies 
(gestation more than 52 weeks).

The value `999` has been used to code an unknown value in the `ht` 
variable. In the `mutate-variables` chunk, use `mutate` to update `ht`, 
replacing `999` with `NA`.

---

# Chaining

We can use `%&gt;%` to pipe the data from one step to the next


```r
infant &lt;- infant %&gt;% 
    filter(smoke != 9 &amp; age &gt; 18) %&gt;%
    select(-(id:outcome), -sex) %&gt;%
    mutate(wt = ifelse(wt == 999, NA, wt),
           wt = wt * 0.4536)
```

Any function with data as the first argument can be added to the data
pipeline.

---

# `summarise()`

`summarise()` function is for computing single number summaries of variables,
so typically comes at the end of a pipeline or in a separate step


```r
stats &lt;- summarise(infant,
                   `Mean mother's weight (kg)` = mean(wt, na.rm = TRUE),
                   `Sample size` = sum(!is.na(wt)),
                   `Total sample size` = n())
stats
```

```
# # A tibble: 1 x 3
#   `Mean mother's weight (kg)` `Sample size` `Total sample size`
#                         &lt;dbl&gt;         &lt;int&gt;               &lt;int&gt;
# 1                        58.4          1167                1203
```

In an R markdown document we can convert the result to a markdown table using
`kable` from the **knitr** package


```r
kable(stats, align = "ccc")
```


---

# Grouped Operations

`group_by()` sets grouping on a data frame. This is most 
useful  for `summarise()`


```r
infant &lt;- infant %&gt;% filter(!race %in% c(10, 99)) %&gt;%
    mutate(race = recode(race, `6` = "Latino", `7` = "Black", `8` = "Asian",
                         `9` = "Mixed", .default = "White"))
res &lt;- infant %&gt;% group_by(`Ethnic group` = race) %&gt;%
    summarise(`Mean weight (kg)` = mean(wt, na.rm = TRUE))
kable(res, align = "lc")
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Ethnic group &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Mean weight (kg) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Asian &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 49.84 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Black &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 62.63 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Latino &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 54.12 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Mixed &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 58.46 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; White &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 57.86 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

# Your Turn

`cut()` (in the **base** package) can be used to create a factor 
from a continuous variable:


```r
cut(c(0.12, 1.37, 0.4, 2.3), breaks = c(0, 1, 2, 3))
```

```
# [1] (0,1] (1,2] (0,1] (2,3]
# Levels: (0,1] (1,2] (2,3]
```

where `(0, 1]` is the set of numbers &gt; 0 and &amp;le; 1, etc.

The infant birth weight `bwt` is given in ounces. In the `table-bwt` chunk use  `mutate()` to create a new factor called `Birth weight (g)`, by converting `bwt` 
to grams through multiplication by 28.35 and then converting 
the result to a factor with the following categories: (1500, 2000], (2000, 2500], (2500, 3000], (3000, 3500], and (3500, 5000].

An infant is categorised as low weight if its birth weight is ≤ 2500 grams, 
regardless of gestation. Use `group_by()` to group the data by the new 
weight factor, then pipe to `summarise()` to count the number of infants in 
each weight category.

---

class: inverse center middle

# Plotting in R

---

# Plots

In RStudio, graphs are displayed in the Plots window. The plot is sized to fit 
the window and will be rescaled if the size of the window is changed.

Back and forward arrows allow you to navigate through graphs that have been plotted.

Graphs can be saved in various formats using the Export drop down menu, which 
also has an option to copy to the clipboard.

First we consider "no-frills" plots, for quick exploratory plots.

---

# Boxplots


```r
boxplot(infant$bwt)
with(infant, boxplot(bwt ~ race))
```

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="index_files/figure-html/unnamed-chunk-24-1.png" alt="Left: boxplot of of birth weight. Right: boxplots of birth weight for each ethnic group." width="40%" /&gt;&lt;img src="index_files/figure-html/unnamed-chunk-24-2.png" alt="Left: boxplot of of birth weight. Right: boxplots of birth weight for each ethnic group." width="40%" /&gt;
&lt;p class="caption"&gt;Left: boxplot of of birth weight. Right: boxplots of birth weight for each ethnic group.&lt;/p&gt;
&lt;/div&gt;


---

# Histogram/Density


```r
hist(infant$bwt)
plot(density(infant$bwt))
```

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="index_files/figure-html/unnamed-chunk-25-1.png" alt="Left: histogram of of birth weight. Right: density curve of birth weight." width="40%" /&gt;&lt;img src="index_files/figure-html/unnamed-chunk-25-2.png" alt="Left: histogram of of birth weight. Right: density curve of birth weight." width="40%" /&gt;
&lt;p class="caption"&gt;Left: histogram of of birth weight. Right: density curve of birth weight.&lt;/p&gt;
&lt;/div&gt;

---

# Scatterplots


```r
infant &lt;- infant %&gt;%
    mutate(gestation = ifelse(gestation == 999, NA, gestation))
plot(bwt ~ gestation, data = infant)
```

```r
# plot(infant$gestation, infant$bwt); plot(x = infant$gestation, y = infant$bwt)
```

.pull-left[
![:width RStudio screenshot, 80%](scatter.png)
]

.pull-left[
The two observations with very low gestation look suspect, so we will 
exclude them from the rest of the analysis

```r
infant &lt;- infant %&gt;%
    filter(gestation &gt; 200)
```

]

---

# ggplot2

**ggplot2** is a package that produces plots based on the *grammar of graphics* 
(Leland Wilkinson), the idea that you can build every graph from the same 
components

 - a data set
 - a co-ordinate system
 - and *geoms* visual marks that represent data points

To display values, you map variables in the data to visual properties of 
the geom (*aesthetics*), like size, colour, x-axis and y-axis.

It provides a unified system for graphics, simplifies tasks such as 
adding legends, and is fully customisable.

---

# ggplot2 boxplots


```r
library(ggplot2)
ggplot(infant, aes(y = bwt * 28.35, x = race)) +
    geom_boxplot() + 
    ylab("Birth Weight (g)")
```

&lt;img src="index_files/figure-html/unnamed-chunk-27-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# ggplot2 with Colour


```r
infant &lt;- mutate(infant, smoke = recode_factor(smoke, 
                                               `1` = "currently", `2`= "until pregnancy", 
                                               `3` = "used to", `0` = "never"))
p &lt;- ggplot(infant, aes(y = bwt * 28.35, x = gestation, color = smoke)) +
    geom_point() + labs(x = "Gestation", y = "Birth Weight (g)", color = "Smoking status")
p
```

&lt;img src="index_files/figure-html/unnamed-chunk-28-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# ggplot2 Facetting


```r
p + facet_wrap(~ smoke) + guides(color = FALSE)
```

&lt;img src="index_files/figure-html/unnamed-chunk-29-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---

# Plots in R Markdown

The chunk options enable you to arrange plots (caption used as alt text in HTML slides)

````r
```{r, fig.show = "hold", fig.align = "center", fig.width = 4, fig.height = 4,
 ¬ fig.cap = "Left: ggplot histogram. Right: ggplot density curve", out.width = "30%"}
ggplot(infant, aes(x = bwt * 28.35)) + geom_histogram(bins = 20)
ggplot(infant, aes(x = bwt * 28.35)) + geom_density()
```
````
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="index_files/figure-html/unnamed-chunk-30-1.png" alt="Left: ggplot histogram. Right: ggplot density curve" width="25%" /&gt;&lt;img src="index_files/figure-html/unnamed-chunk-30-2.png" alt="Left: ggplot histogram. Right: ggplot density curve" width="25%" /&gt;
&lt;p class="caption"&gt;Left: ggplot histogram. Right: ggplot density curve&lt;/p&gt;
&lt;/div&gt;

---

# Your Turn

Inspect the association between birth weight (`bwt`) and mother’s age 
(`age`) with a ggplot. Use `geom_smooth(method = "lm")` to add a linear 
smooth with confidence interval.

Does the association depend on smoking status? (Hint: assign one or more
aesthetics to `smoke`).

---

class: inverse center middle

# Linear Modelling

---

# Simple Linear Modelling

The `lm()` function can be used to fit linear models, e.g. a simple 
linear model of `bwt` vs `gestation`


```r
model1 &lt;- lm(bwt ~ gestation, data = infant)
model1
```

```
# 
# Call:
# lm(formula = bwt ~ gestation, data = infant)
# 
# Coefficients:
# (Intercept)    gestation  
#     -22.171        0.507
```

Diagnostic plots can be created by plotting the model object


```r
plot(model1)
```

(result on next slide).
---
    
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="index_files/figure-html/unnamed-chunk-33-1.png" alt="Top left: residuals vs fitted scatterplot. Top right: Square root of standardized residuals vs fitted values. Bottom left: Q-Q plot. Bottom right: standardised residuals vs leverage." width="34%" /&gt;&lt;img src="index_files/figure-html/unnamed-chunk-33-2.png" alt="Top left: residuals vs fitted scatterplot. Top right: Square root of standardized residuals vs fitted values. Bottom left: Q-Q plot. Bottom right: standardised residuals vs leverage." width="34%" /&gt;&lt;img src="index_files/figure-html/unnamed-chunk-33-3.png" alt="Top left: residuals vs fitted scatterplot. Top right: Square root of standardized residuals vs fitted values. Bottom left: Q-Q plot. Bottom right: standardised residuals vs leverage." width="34%" /&gt;&lt;img src="index_files/figure-html/unnamed-chunk-33-4.png" alt="Top left: residuals vs fitted scatterplot. Top right: Square root of standardized residuals vs fitted values. Bottom left: Q-Q plot. Bottom right: standardised residuals vs leverage." width="34%" /&gt;
&lt;p class="caption"&gt;Top left: residuals vs fitted scatterplot. Top right: Square root of standardized residuals vs fitted values. Bottom left: Q-Q plot. Bottom right: standardised residuals vs leverage.&lt;/p&gt;
&lt;/div&gt;

---

# Standard summary
    

```r
summary(model1)
```

```
# 
# Call:
# lm(formula = bwt ~ gestation, data = infant)
# 
# Residuals:
#    Min     1Q Median     3Q    Max 
# -49.42 -10.98   0.09  10.05  53.58 
# 
# Coefficients:
#             Estimate Std. Error t value Pr(&gt;|t|)    
# (Intercept) -22.1707     8.8608    -2.5    0.012 *  
# gestation     0.5074     0.0316    16.0   &lt;2e-16 ***
# ---
# Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
# 
# Residual standard error: 16.6 on 1173 degrees of freedom
# Multiple R-squared:  0.18,	Adjusted R-squared:  0.179 
# F-statistic:  257 on 1 and 1173 DF,  p-value: &lt;2e-16
```

---
    
# broom package

`tidy()` and `glance()` from **broom** extract coefficient and model statistics


```r
library(broom)
tidy(model1)
```

```
# # A tibble: 2 x 5
#   term        estimate std.error statistic  p.value
#   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
# 1 (Intercept)  -22.2      8.86       -2.50 1.25e- 2
# 2 gestation      0.507    0.0316     16.0  1.80e-52
```

```r
glance(model1)
```

```
# # A tibble: 1 x 11
#   r.squared adj.r.squared sigma statistic  p.value    df logLik
#       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;
# 1     0.180         0.179  16.6      257. 1.80e-52     2 -4965.
# # … with 4 more variables: AIC &lt;dbl&gt;, BIC &lt;dbl&gt;, deviance &lt;dbl&gt;,
# #   df.residual &lt;int&gt;
```

`augment()` can be used to augment the original data with fitted values etc.

---

# Multiple Regression

Additional terms can be added to the model via `+`


```r
y ~ a + b + c
```

We can use `update` to update a fitted model, changing any aspect of the 
model call. We can update the formula by adding or subtracting terms.


```r
update(fit, . ~ . + d - c)
```

All linear models have an intercept by default, it can be removed with `-1`.

`anova()` can applied to a single model to assess the significance of 
each term or nested models to assess the significance of additional terms.

---
    
# Your Turn

Use `lm()` to model birth weight against both gestation and the key 
maternal characteristics weight (`wt`), height (`ht`), parity and race. 
Use `anova()` to inspect the results.

Now add the smoking variables: smoking status (`smoke`), time since 
quitting (`time`) and number of cigarettes smoked per day (`number`). 
Inspect the results - are all the smoking variables significant? 

Use `anova(fit1, fit2)` to produce compare the two models.

---

# Learning more/getting support

RStudio cheatsheets (rmarkdown, dplyr, ggplot2) https://www.rstudio.com/resources/cheatsheets/

R for Data Science (data handling, basic programming and modelling, R markdown) http://r4ds.had.co.nz

RStudio Community (friendly forum focused on "tidyverse" packages, including dplyr, ggplot2) https://community.rstudio.com/

---

# Going further

Quick-R (basic "how to"s from data input to advanced statistics) http://www.statmethods.net/

Task views http://cran.r-project.org/web/views/
provide an overview of R’s support for different
topics, e.g. Bayesian inference, survival analysis, ...

http://www.rseek.org/ – search the web, online
manuals, task views, mailing lists and functions.

Package vignettes, many books, e.g. on https://bookdown.org/.

---

# License

&lt;a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"&gt;&lt;img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /&gt;&lt;/a&gt;&lt;br /&gt;&lt;span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"&gt;Package Development Workshop&lt;/span&gt; by &lt;span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName"&gt;Forwards&lt;/span&gt; is licensed under a &lt;a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"&gt;Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License&lt;/a&gt;.
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="../../libs/remark-latest.min.js"></script>
<script src="macros.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "googlecode",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_HTMLorMML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
